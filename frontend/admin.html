<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Nestra — Admin</title>

  <!-- Google font (same as index) -->
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">

  <style>
    :root{
      --primary: #6c5dd3;
      --secondary: #463aa2;
      --gradient: linear-gradient(135deg,#6c5dd3,#463aa2);
      --bg: linear-gradient(120deg,#eae8ff,#f7f5ff);
      --card: #ffffff;
      --muted: #5e5c7a;
      --glass: rgba(255,255,255,0.06);
    }

    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family:'Outfit',system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      background:var(--bg);
      color:#222;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* Topbar / Navbar (same style as index.html) */
    .topbar{
      backdrop-filter: blur(8px);
      background: rgba(255,255,255,0.6);
      border-bottom: 1px solid rgba(0,0,0,0.04);
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 14px 20px;
      position: sticky;
      top:0;
      z-index:999;
    }
    .logo{
      font-size:1.6rem;
      font-weight:700;
      color:var(--secondary);
      letter-spacing: -0.5px;
    }

    .nav-toggle{
      display:none;
      font-size:1.4rem;
      cursor:pointer;
      color:var(--secondary);
    }

    .dropdown-menu{
      list-style:none;
      display:flex;
      gap:1.2rem;
      align-items:center;
    }
    .dropdown-menu a{
      text-decoration:none;
      color:#2d2d39;
      font-weight:600;
      position:relative;
      padding:6px 0;
    }
    .dropdown-menu a::after{
      content:"";
      position:absolute;
      left:0;bottom:-6px;
      height:2px;
      width:0;
      background:var(--primary);
      transition:width .25s;
    }
    .dropdown-menu a:hover::after{ width:100%; }

    /* Page header */
    .page-header{
      text-align:center;
      padding:40px 20px 20px;
    }
    .page-header h1{
      font-size:2.1rem;
      color:var(--secondary);
      margin-bottom:8px;
    }
    .page-header p{ color:var(--muted); }

    /* Card container */
    .container{
      max-width:1200px;
      margin:20px auto;
      padding:20px;
    }
    .card{
      background:var(--card);
      border-radius:14px;
      padding:20px;
      box-shadow: 0 14px 30px rgba(70,58,162,0.08);
      overflow:auto;
    }

    /* DataTable visual tweaks */
    table.dataTable{
      border-collapse:separate!important;
      border-spacing:0;
      width:100% !important;
      background:transparent;
    }
    table.dataTable thead th{
      background: linear-gradient(90deg, #463aa2, #6c5dd3);
      color:#fff;
      border:0;
      font-weight:700;
      padding:12px 16px;
    }
    table.dataTable tbody td{
      padding:12px 14px;
      vertical-align:middle;
      color:#222;
    }
    .dt-buttons{ margin-bottom:8px; }

    /* Action buttons from backend (if plain buttons), fallback styling */
    .editBtn{
      background:#f59e0b; color:#fff; border:0; padding:6px 10px; border-radius:8px; cursor:pointer; margin-right:8px;
    }
    .deleteBtn{
      background:#ef4444; color:#fff; border:0; padding:6px 10px; border-radius:8px; cursor:pointer;
    }

    /* Responsive */
    @media (max-width: 768px){
      .nav-toggle{ display:block; }
      .dropdown-menu{ display:none; position:absolute; top:64px; right:16px; background:var(--card); flex-direction:column; padding:12px; border-radius:10px; box-shadow:0 8px 20px rgba(0,0,0,0.08); }
      .dropdown-menu.show{ display:flex; }
      .page-header{ padding:28px 14px; }
      .container{ padding:12px; }
    }
  </style>
</head>
<body>

  <nav class="topbar">
    <div class="logo">Nestra</div>
    <div class="nav-toggle" id="navToggle">☰</div>
    <ul class="dropdown-menu" id="navMenu">
      <li><a href="index.html">Home</a></li>
      <li><a href="login.html">Login</a></li>
      <li><a href="register.html">Register</a></li>
      <li><a href="survey.html">Survey</a></li>
      <li><a href="match_result.html">Match Result</a></li>
      <li><a href="admin.html" style="opacity:0.9">Admin</a></li>
    </ul>
  </nav>

  <header class="page-header">
    <h1>Admin Dashboard</h1>
    <p>Manage registered users and survey data — powered by DataTables</p>
  </header>

  <main class="container">
    <div class="card">
      <table id="adminTable" class="display" style="width:100%">
        <thead>
          <tr>
            <th>ID</th>
            <th>Username</th>
            <th>Email</th>
            <th>Created At</th>
            <th>Actions</th>
          </tr>
        </thead>
        <!-- DataTables will inject rows -->
      </table>
    </div>
  </main>

  <!-- scripts -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

  <script>
    // mobile menu toggle
    document.getElementById('navToggle').addEventListener('click', function(){
      document.getElementById('navMenu').classList.toggle('show');
    });

    // Initialize DataTable
    $(document).ready(function(){
      $('#adminTable').DataTable({
        processing: true,
        ajax: {
          url: '../backend/fetch_admin_data.php', // adjust if your path differs
          type: 'GET',
          dataSrc: 'data',
          error: function(xhr, status, error) {
            console.error('DataTables AJAX error:', status, error);
            // optional: show friendly message in table
            const table = $('#adminTable').DataTable();
            table.clear().draw();
            // You can also display an overlay or message to the user here.
          }
        },
        columns: [
          { data: 0 }, // id
          { data: 1 }, // username
          { data: 2 }, // email
          { data: 3 }, // created_at
          {
            data: 4,     // actions HTML (backend returns HTML)
            orderable: false,
            searchable: false,
            render: function(data, type, row, meta){
              // data is HTML string returned by backend (buttons).
              // Ensure it's rendered as HTML
              return data;
            }
          }
        ],
        pageLength: 10,
        lengthMenu: [10,25,50],
        responsive: true,
        language: {
          emptyTable: "No users found — try refreshing or check the backend."
        }
      });
    });

    // Delegate click handlers for action buttons (they are created by backend HTML)
    document.addEventListener('click', function(e){
      if (e.target && e.target.classList.contains('editBtn')) {
        const id = e.target.getAttribute('data-id');
        // implement edit behavior (redirect, modal, etc)
        window.location.href = `edit_user.php?id=${id}`;
      }
      if (e.target && e.target.classList.contains('deleteBtn')) {
        const id = e.target.getAttribute('data-id');
        if (confirm('Delete user ID ' + id + '? This action cannot be undone.')) {
          // call backend delete endpoint (adjust path as needed)
          fetch('../backend/delete_user.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: 'id=' + encodeURIComponent(id)
          })
          .then(r => r.text())
          .then(resp => {
            alert(resp);
            // reload table
            $('#adminTable').DataTable().ajax.reload(null, false);
          })
          .catch(err => {
            console.error(err);
            alert('Delete failed — check console for details.');
          });
        }
      }
    });
  </script>
</body>
</html>
